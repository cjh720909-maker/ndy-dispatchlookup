generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// 1. 발주/주문 테이블 (t_balju)
model Order {
  id              Int      @id @default(autoincrement()) @map("B_IDX")
  date            String?  @map("B_DATE")
  
  productCode     String?  @map("B_P_NO")   
  productName     String?  @map("B_P_NAME") 
  qty             Int      @default(0) @map("B_QTY") // 원주문수량
  outQty          Int      @default(0) @map("O_QTY") // 출고수량
  weight          Decimal  @default(0.00) @map("B_KG") 

  customerName    String?  @map("B_C_NAME")
  customerCode    String?  @map("B_C_CODE")
  driverName      String?  @map("CB_DRIVER") 
  deliveryPointId Int?     @map("CB_IDX")

  
  // [New] 회사 구분 컬럼 (유저 요청: t_balju c_name)
  companyNameInTable String? @map("C_NAME")

  // 관계 설정
  vehicle         Vehicle? @relation(fields: [driverName], references: [driverName])
  deliveryPoint   DeliveryPoint? @relation(fields: [deliveryPointId], references: [id])
  
  // [핵심] 미출(결품) 테이블 연결
  missouts        Missout[]

  @@map("t_balju")
}

// 2. [신규] 미출 현황 테이블 (t_missout)
// 이 테이블에 데이터가 있으면 '결품'입니다.
model Missout {
  id        Int     @id @default(autoincrement()) @map("MO_IDX")
  orderId   Int?    @map("B_IDX")
  qty       Int     @default(0) @map("B_QTY") // 미출 수량
  
  order     Order?  @relation(fields: [orderId], references: [id])

  @@map("t_missout")
}

// 3. 차량/기사 정보 (t_car)
model Vehicle {
  driverName  String  @unique @map("CB_DRIVER") 
  realDriverName String? @map("CA_NAME") // 실제 기사 성명
  vehicleNo   String? @map("CA_NO")      
  driverPhone String? @map("CA_HP")      
  dockNo      String? @map("CA_DOCKNO") 

  orders      Order[]

  @@map("t_car")
}

// 4. 배송지 정보 (t_cust_bae)
model DeliveryPoint {
  id          Int     @id @default(autoincrement()) @map("CB_IDX")
  name        String? @map("CB_NAME")   // 납품처명
  defaultDriver String? @map("CB_DRIVER") // 고정 기사
  code        String? @map("CB_CODE")   // 코드
  routingBind String? @map("CB_BIND") 
  address     String? @map("CB_ADDRESS") 

  orders      Order[]

  @@map("t_cust_bae")
}

// 5. [신규] 사용자/로그인 정보 (t_user)
model User {
  id          Int      @id @default(autoincrement()) @map("U_IDX")
  username    String   @unique @map("U_ID")
  password    String   @map("U_PW")
  companyName String?  @map("U_COMPANY") // "하회", "대상" 등 (UTF-8)
  createdAt   DateTime @default(now()) @map("U_CREATED_AT")

  @@map("t_user")
}